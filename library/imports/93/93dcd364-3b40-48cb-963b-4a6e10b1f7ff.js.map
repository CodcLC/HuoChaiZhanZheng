{"version":3,"sources":["assets\\scripts\\game\\ui\\playerHp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport { data } from \"../../sdk/data\";\nimport Events from \"../Events\";\nimport GameManager from \"../GameManager\";\nimport uiManager from \"./uiManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class playerHp extends cc.Component {\n\n    @property(cc.Label)\n    hpLabel:cc.Label=null;\n    @property(cc.ProgressBar)\n    hpBar:cc.ProgressBar=null;\n    @property(cc.Node)\n    cursor:cc.Node=null;//血条光标\n    @property(cc.Node)\n    bar:cc.Node=null;\n\n    damageScale: number = 0;//普攻1伤害值 （60,80,150）\n    damageShuriken:number=0;//手里剑伤害\n    damageSowrdRain:number=0;//剑雨伤害\n    hp_max:number=0;\n    hp_now:number=0;\n    damageLv:number=0;//属性等级\n    healthLv:number=0;\n    speedLv:number=0;\n    damageIncremental:number=0.2;//属性每级递增量\n    healthIncremental:number=0.2;\n    speedIncremental:number=0.1;\n    speedTimes:number=0;\n    static instance:playerHp=null;\n    onLoad () {\n        playerHp.instance=this;\n    }\n\n    start () {\n        this.init();\n    }\n    init(){\n        this.isOpenFullHp = false\n        \n        this.damageLv=Number(data.getCache(\"attributeLv\",\"damage\"));\n        this.healthLv=Number(data.getCache(\"attributeLv\",\"health\"));\n        this.speedLv=Number(data.getCache(\"attributeLv\",\"speed\"));\n        this.hp_max=Number(data.getCache(\"Base\",\"playerHp\"))*(1+this.healthLv*this.healthIncremental);\n        this.damageScale=Number(data.getCache(\"Base\",\"playerDamage\"))*(1+this.damageLv*this.damageIncremental);\n        this.damageShuriken=Number(data.getCache(\"Base\",\"shurikenDamage\"))*(1+this.damageLv*this.damageIncremental);\n        this.damageSowrdRain=Number(data.getCache(\"Base\",\"swordRainDamage\"))*(1+this.damageLv*this.damageIncremental);\n        this.hp_now=this.hp_max;\n        this.speedTimes=1+this.speedLv/10;\n        this.updateLabel();\n    }\n    fullHp(){\n        this.addHp(this.hp_max-this.hp_now);\n    }\n    addHp(addNum:number,isRevive:boolean=false){\n        addNum=Math.floor(addNum);\n        this.hp_now += addNum;\n        this.hp_now=this.hp_now>this.hp_max?this.hp_max:this.hp_now;\n        this.updateLabel();\n        let offsetX=GameManager.instance.playerController.skeleton.node.scaleX>0?-35:35;\n        Events.instance.showAddHp_player(GameManager.instance.player,addNum,offsetX,isRevive);\n    }\n\n    isOpenFullHp:boolean = false\n    updateHp(damage: number) {\n        damage=Math.floor(damage);\n        this.createBarFadeOut();\n        this.hp_now -= damage;\n        this.hp_now=this.hp_now<0?0:this.hp_now;\n        this.updateLabel();\n        if (this.hp_now <= 0) {\n            this.hp_now = 0;\n            GameManager.instance.playerController.die();\n        }\n        if(GameManager.instance.playerController.isDie == false && this.isOpenFullHp == false){//////////\n            if (this.hp_now < this.hp_max/3)\n            {\n                this.isOpenFullHp = true\n                uiManager.ins.showFullHpPopup()\n            }\n        }\n    }\n    updateLabel(){\n        this.hpBar.progress = this.hp_now / this.hp_max;\n        this.cursor.x=this.hpBar.progress*300;\n        this.hpLabel.string=this.hp_now+\"/\"+this.hp_max;\n    }\n    createBarFadeOut(){\n        let newBar=cc.instantiate(this.bar);\n        newBar.setParent(this.bar.parent);\n        newBar.setPosition(this.bar.position);\n        cc.tween(newBar)\n        .to(0.3,{opacity:0,color:cc.Color.WHITE})\n        .call(()=>{\n            newBar.destroy();\n        })\n        .start();\n    }\n}\n"]}