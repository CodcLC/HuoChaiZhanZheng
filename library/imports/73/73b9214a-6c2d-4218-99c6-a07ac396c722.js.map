{"version":3,"sources":["assets\\framework\\script\\ui-manager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIBase from \"./ui-base\";\nconst TAG = 'ui-manager.ts';\nconst UIROOT_ZINDEX = 999;\nconst UIROOT_NAME = 'ui-root';\nconst DEFAULT_CANVAS = 'ui-default-node';\ninterface uiConfig {\n    /** \n    预制体文件位置 */\n    file_url: string;\n    /**\n    所属资源包*/\n    bundle: string;\n    /**\n    所属画布节点*/\n    canvas: string;\n}\nclass UIMap {\n    /** \n    预制体 */\n    prefab: cc.Prefab;\n    /** \n    UI对象 */\n    ui: UIBase;\n    /**\n    UI配置信息*/\n    config: uiConfig;\n    /** \n    预加载 */\n    preload?: boolean;\n    /**\n    是否依赖场景*/\n    relyon_scnene?: boolean\n}\nclass uiManager {\n    /** \n    UI 根节点 */\n    private _uiRoot: cc.Node = null;\n    /**\n    UI 配置表 Map */\n    private _uiConfigMap: Map<string, uiConfig> = null;\n    /** \n    UI 配置信息 Map */\n    private _uiMap: Map<string, UIMap> = null;\n    /**\n    UI 画布节点 Map*/\n    private _canvasMap: Map<string, cc.Node> = null;\n    /** \n    构造函数 */\n    constructor() {\n        this._uiConfigMap = new Map<string, uiConfig>();\n        this._uiMap = new Map<string, UIMap>();\n        this._canvasMap = new Map<string, cc.Node>();\n    }\n    /**\n     * 获取UI配置信息\n     * @param uiname \n     */\n    private async _getMUI(uiname: string) {\n        let mui: UIMap = this._uiMap.get(uiname);\n        if (!mui) {\n            let config = await this.getConfig(uiname);\n            if (config) {\n                let prefab = await loadPrefab(config.file_url, config.bundle);\n                mui = new UIMap();\n                mui.prefab = prefab;\n                mui.config = config;\n                mui.ui = null;\n                prefab.addRef();\n                this._uiMap.set(uiname, mui);\n            } else {\n                cc.warn(TAG, `not find ${uiname} in file: ui-config`);\n            }\n        }\n        return mui;\n    }\n    /**\n     * 获得UI根节点\n     * @returns cc.Node\n     */\n    private getUIRoot() {\n        if (!this._uiRoot) {\n            this._uiRoot = new cc.Node(UIROOT_NAME);\n            cc.director.getScene().addChild(this._uiRoot, UIROOT_ZINDEX);\n            cc.game.addPersistRootNode(this._uiRoot);\n            this._uiRoot.setAnchorPoint(cc.v2(0, 0));\n            this._uiRoot.setPosition(cc.v2(0, 0));\n            this._uiRoot.setContentSize(cc.winSize);\n        }\n        return this._uiRoot;\n    }\n    /**\n     * 构建一个UI画布节点\n     * @param cname 画布节点名称\n     * @returns cc.Node\n     */\n    private _getCanvas(cname: string = DEFAULT_CANVAS) {\n        if (!cname) {\n            cname = DEFAULT_CANVAS;\n        }\n        let canvas: cc.Node = this._canvasMap.get(cname);\n        if (!canvas) {\n            canvas = new cc.Node(cname);\n            this.getUIRoot().addChild(canvas);\n            canvas.setAnchorPoint(cc.v2(0, 0));\n            let widget = canvas.addComponent(cc.Widget);\n            widget.alignMode = cc.Widget.AlignMode.ON_WINDOW_RESIZE;\n            widget.isAlignTop = true;\n            widget.isAlignBottom = true;\n            widget.isAlignLeft = true;\n            widget.isAlignRight = true;\n            widget.top = 0;\n            widget.bottom = 0;\n            widget.left = 0;\n            widget.right = 0;\n            this._canvasMap.set(cname, canvas);\n        }\n        return canvas;\n    }\n    /**\n     * 构建一个UI\n     * @param uiname UI名称\n     * @param mui UI配置信息\n     * @param rootNode 自定义根节点\n     * @param create 是否创建\n     * @returns UIBase\n     */\n    private async _getUI(uiname: string, mui: UIMap, rootNode: cc.Node, create: boolean = false) {\n        let ui = mui.ui;\n        if (!ui && create) {\n            let node = cc.instantiate(mui.prefab);\n            let canvas = rootNode ? rootNode : this._getCanvas(mui.config.canvas);\n            canvas.addChild(node);\n            node.active = false;\n            node.setPosition(rootNode ? cc.v2(0, 0) : cc.v2(cc.winSize.width / 2, cc.winSize.height / 2));\n            ui = node.getComponent(UIBase) || node.getComponentInChildren(UIBase);\n            if (!ui) {\n                ui = node.addComponent(UIBase);\n            }\n            ui._setRootNode(node);\n            ui._setCanvas(canvas);\n            ui._setUIName(uiname);\n            await ui.onUICreate();\n            mui.ui = ui;\n            this._uiMap.set(uiname, mui);\n        }\n        return ui;\n    }\n    /**\n     * 打开指定UI\n     * @param uiname UI名称\n     * @param rootNode 根节点\n     * @param preload 预加载\n     * @param args 启动参数\n     * @returns Promise<UIBase>\n     */\n    async openUI(uiname: string, rootNode: cc.Node = null, preload: boolean = false, ...args: any[]) {\n        return new Promise<UIBase>(async (resolve) => {\n            let ui: UIBase = null;\n            let mui: UIMap = await this._getMUI(uiname);\n            if (mui) {\n                ui = mui.ui;\n                mui.preload = preload;\n                if (!ui) {\n                    ui = await this._getUI(uiname, mui, rootNode, true);\n                    mui.relyon_scnene = rootNode ? true : false;\n                }\n                if (ui && !preload) {\n                    ui._setActive(true);\n                    ui.onUILaunch(...args);\n                }\n            }\n            resolve(ui);\n        });\n    }\n    /**\n     * 关闭指定UI\n     * @param uiname UI名称\n     * @param release 释放对象\n     */\n    closeUI(uiname: string, release: boolean = false) {\n        let mui: UIMap = this._uiMap.get(uiname);\n        if (mui) {\n            let ui = mui.ui;\n            if (ui) {\n                ui.onUIClose();\n                ui._setActive(false);\n            }\n            if (release) {\n                console.log('release: ' + uiname);\n                this.releaseUI(uiname);\n            }\n        }\n    }\n    /**\n     * 设置UI索引,UI不会被关闭释放\n     * @param uiname \n     * @param z_index\n     */\n    setUIzIndex(uiname: string, z_index: number = 0) {\n        let mui: UIMap = this._uiMap.get(uiname);\n        if (mui) {\n            let ui = mui.ui;\n            if (ui) {\n                ui._setSiblingIndex(z_index);\n                ui.onIndexChange(z_index);\n            }\n        }\n    }\n    /**\n     * 释放指定UI\n     * @param uiname \n     */\n    releaseUI(uiname: string) {\n        let mui: UIMap = this._uiMap.get(uiname);\n        if (mui) {\n            let ui = mui.ui;\n            if (ui) {\n                ui.onUIRelease();\n                ui.node.destroy();\n                mui.prefab.decRef();\n                mui.prefab = null;\n                mui.ui = null;\n                mui.config = null;\n                this._uiMap.delete(uiname);\n            }\n        }\n    }\n    /**\n     * 自动释放依赖场景的UI\n     */\n    autoRelease() {\n        let delete_keys: string[] = [];\n        this._uiMap.forEach((mui: UIMap, key: string) => {\n            if (mui.relyon_scnene) {\n                delete_keys.push(key);\n            }\n        });\n        if (delete_keys.length > 0) {\n            for (let i = 0; i < delete_keys.length; i++) {\n                console.log('auto release: ' + delete_keys[i]);\n                this.releaseUI(delete_keys[i]);\n            }\n        }\n    }\n    /**\n     * 获取UI配置表单\n     * @param uiname \n     */\n    private getConfig(uiname: string) {\n        return new Promise<uiConfig>((resolve) => {\n            let uiconf = this._uiConfigMap.get(uiname);\n            if (uiconf) {\n                resolve(uiconf);\n            } else {\n                cc.resources.load('json/ui-config', cc.JsonAsset, (err, asset: cc.JsonAsset) => {\n                    if (!err && asset) {\n                        this._uiConfigMap.set(uiname, asset.json.ui[uiname]);\n                        resolve(this._uiConfigMap.get(uiname));\n                    } else {\n                        cc.warn(TAG, `not find ui-config in ${cc.resources.name}`);\n                        resolve(null);\n                    }\n                });\n            }\n        });\n    }\n}\n/**\n* 加载预制体\n* @param url \n* @param bundle \n* @returns Promise<cc.Prefab>\n*/\nfunction loadPrefab(url: string, bundle?: string) {\n    return new Promise<cc.Prefab>((resolve) => {\n        if (bundle) {\n            let asset_bundle = cc.assetManager.getBundle(bundle);\n            if (asset_bundle) {\n                asset_bundle.load(url, cc.Prefab, (err, prefab: cc.Prefab) => {\n                    if (!err && prefab) {\n                        resolve(prefab);\n                    } else {\n                        resolve(null);\n                        cc.warn(TAG, `not find ${url} in ${bundle}`);\n                    }\n                });\n            } else {\n                cc.assetManager.loadBundle(bundle, (err, _bundle) => {\n                    if (!err && _bundle) {\n                        _bundle.load(url, cc.Prefab, (err, prefab: cc.Prefab) => {\n                            if (!err && prefab) {\n                                resolve(prefab);\n                            } else {\n                                resolve(null);\n                                cc.warn(TAG, `not find ${url} in ${bundle}`);\n                            }\n                        });\n                    } else {\n                        cc.warn(TAG, `not find bundle ${bundle}`);\n                    }\n                });\n            }\n        } else {\n            cc.resources.load(url, cc.Prefab, (err, prefab: cc.Prefab) => {\n                if (!err && prefab) {\n                    resolve(prefab);\n                } else {\n                    resolve(null);\n                    console.log(TAG, `not find ${url} in ${cc.resources.name}`);\n                }\n            });\n        }\n    });\n}\nexport const uiMgr = new uiManager();\n"]}