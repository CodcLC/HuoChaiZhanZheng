{"version":3,"sources":["assets\\scripts\\game\\ui\\playerControlEvent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameManager from \"../GameManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class playerControlEvent extends cc.Component {\n\n    @property(cc.Integer)\n    rollCD:number=0;\n    @property(cc.Integer)\n    skill1CD:number=0;\n    @property(cc.Integer)\n    skill2CD:number=0;\n    @property(cc.Node)\n    buttons:cc.Node[]=[];//0-attack 1-roll 2-jump 3-skill1 4-skill2\n    \n    inited:boolean=false;\n    isRollCd:boolean=false;\n    isSkill1Cd:boolean=false;\n    isSkill2Cd:boolean=false;\n    isContinueAttack:boolean=false;\n    static instance:playerControlEvent=null;\n\n    onLoad(){\n        playerControlEvent.instance=this;\n    }\n    init(){\n        cc.tween(this.node).to(0.5,{opacity:255}).start();\n        this.bindingEvent();\n    }\n    bindingEvent(){\n        this.buttons[0].on(cc.Node.EventType.TOUCH_START,this.attack,this);\n        this.buttons[0].on(cc.Node.EventType.TOUCH_END,this.attackTouchEnd,this);\n        this.buttons[0].on(cc.Node.EventType.TOUCH_CANCEL,this.attackTouchEnd,this);\n        this.buttons[1].on(cc.Node.EventType.TOUCH_START,this.roll,this);\n        this.buttons[2].on(cc.Node.EventType.TOUCH_START,this.jump,this);\n        this.buttons[3].on(cc.Node.EventType.TOUCH_START,this.skill1,this);\n        this.buttons[4].on(cc.Node.EventType.TOUCH_START,this.skill2,this);\n    }\n    removeEvent(){\n        this.isContinueAttack=false;\n        this.buttons[0].off(cc.Node.EventType.TOUCH_START,this.attack,this);\n        this.buttons[0].off(cc.Node.EventType.TOUCH_END,this.attackTouchEnd,this);\n        this.buttons[0].off(cc.Node.EventType.TOUCH_CANCEL,this.attackTouchEnd,this);\n        this.buttons[1].off(cc.Node.EventType.TOUCH_START,this.roll,this);\n        this.buttons[2].off(cc.Node.EventType.TOUCH_START,this.jump,this);\n        this.buttons[3].off(cc.Node.EventType.TOUCH_START,this.skill1,this);\n        this.buttons[4].off(cc.Node.EventType.TOUCH_START,this.skill2,this);\n    }\n    attack(){\n        this.isContinueAttack=true;\n        GameManager.instance.playerController.attack();\n    }\n    attackTouchEnd(){\n        this.isContinueAttack=false;\n    }\n    roll(event:cc.Event){\n        if(this.isRollCd) return;\n        this.isRollCd=true;\n        GameManager.instance.playerController.roll();\n\n        this.cdAnimation(event.target,this.rollCD);\n        this.scheduleOnce(()=>{\n            this.isRollCd=false;\n        },this.rollCD);\n    }\n    jump(){\n        GameManager.instance.playerController.jump();\n    }\n    skill1(event:cc.Event){\n        if(this.isSkill1Cd) return;\n        if(GameManager.instance.playerController.skeleton.animation.includes(\"skill\")) return;\n        this.isSkill1Cd=true;\n        GameManager.instance.playerController.skill1();\n\n        this.cdAnimation(event.target,this.skill1CD);\n        this.scheduleOnce(()=>{\n            this.isSkill1Cd=false;;\n        },this.skill1CD);\n    }\n    skill2(event:cc.Event){\n        if(this.isSkill2Cd) return;\n        if(GameManager.instance.playerController.skeleton.animation.includes(\"skill\")) return;\n        this.isSkill2Cd=true;\n        GameManager.instance.playerController.skill2();\n\n        this.cdAnimation(event.target,this.skill2CD);\n        this.scheduleOnce(()=>{\n            this.isSkill2Cd=false;;\n        },this.skill2CD);\n    }\n    cdAnimation(btn:cc.Node,cdTime:number){\n        let cdNode:cc.Node=btn.getChildByName(\"cdNode\");\n        cdNode.active=true;\n        let cdBar:cc.ProgressBar=cdNode.getChildByName(\"cd\").getComponent(cc.ProgressBar);\n        let timerLabel:cc.Label=cdNode.getChildByName(\"timer\").getComponent(cc.Label);\n        let timeObj={time:cdTime}\n        this.timerLabelTween(cdTime,timeObj,timerLabel,cdNode);\n        this.progressBarTween(cdBar,cdTime);\n    }\n    timerLabelTween(cdTime:number,timeObj:object,timerLabel:cc.Label,cdNode:cc.Node){\n        cc.tween(timeObj)\n        .to(cdTime,{time:0},{\n            progress: (start: number, end: number, current: any, t: number) => {\n                //start:起始值 end:终点值 current:当前值 t:总时占比0~1 \n                //返回值为最终赋值\n                let now = cc.misc.lerp(start, end, t);\n                timerLabel.string = now.toFixed(1);\n                return now;\n            }\n        })\n        .call(()=>{\n            cdNode.active=false;\n            this.isRollCd=false;\n        })\n        .start();\n    }\n    progressBarTween(cdBar:cc.ProgressBar,time:number){\n        cc.tween(cdBar)\n        .to(time,{progress:1})\n        .call(()=>{\n            cdBar.progress=0;\n        })\n        .start();\n    }\n}\n"]}