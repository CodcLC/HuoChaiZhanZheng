{"version":3,"sources":["assets\\scripts\\game\\cameraControl.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAGlF,6CAAwC;AAElC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAA2C,iCAAY;IAAvD;QAAA,qEAmEC;QAjEG,gBAAU,GAAS,IAAI,CAAC;QACxB,gBAAU,GAAW,IAAI,CAAC;QAC1B,aAAO,GAAQ,CAAC,CAAC,CAAA,mBAAmB;QAEpC,WAAK,GAAQ,CAAC,GAAG,CAAC;QAClB,WAAK,GAAQ,EAAE,CAAC;QAwDhB,gBAAU,GAAU;YAChB,IAAI,EAAC,EAAE,EAAC,IAAI,EAAC,CAAC,EAAC,GAAG,EAAC,GAAG,EAAC,GAAG,EAAC,GAAG,EAAC,GAAG,EAAC,CAAC;YACpC,IAAI,EAAC,IAAI,EAAC,GAAG,EAAC,IAAI,EAAC,IAAI,EAAC,IAAI,EAAC,CAAC,EAAC,IAAI,EAAC,IAAI,EAAC,IAAI;SAChD,CAAC;;IACN,CAAC;sBAnEoB,aAAa;IAS9B,8BAAM,GAAN;QACI,eAAa,CAAC,QAAQ,GAAC,IAAI,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAC,IAAI,CAAC,IAAI,CAAC;QAC1B,IAAI,CAAC,OAAO,GAAC,CAAC,CAAC,CAAA,yBAAyB;QACxC,IAAI,CAAC,UAAU,GAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;IACtD,CAAC;IAED,6BAAK,GAAL;IAEA,CAAC;IAED,8BAAM,GAAN,UAAQ,EAAE;QACN,IAAG,qBAAW,CAAC,QAAQ,CAAC,gBAAgB,IAAE,IAAI;YAAE,OAAO;QACvD,IAAI,eAAe,GAAC,qBAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,qBAAqB,CAAC,qBAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACnH,IAAI,cAAc,GAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,eAAe,CAAC,CAAC;QAC1E,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;IACvC,CAAC;IACD,qCAAa,GAAb,UAAc,SAAiB,EAAC,cAAc;QAC1C,IAAI,IAAI,GAAC,CAAC,CAAC;QACX,IAAG,CAAC,SAAS,CAAC,CAAC,GAAC,GAAG,CAAC,GAAC,EAAE,EAAC;YACpB,IAAI,GAAC,cAAc,CAAC,CAAC,GAAC,EAAE,CAAC;YACzB,IAAI,GAAC,IAAI,GAAC,IAAI,CAAC,KAAK,CAAA,CAAC,CAAA,IAAI,CAAC,KAAK,CAAA,CAAC,CAAA,IAAI,CAAC;YACrC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAC,IAAI,EAAC,IAAI,CAAC,CAAC;SACnD;aAAK,IAAG,SAAS,CAAC,CAAC,GAAC,GAAG,EAAC;YACrB,IAAI,GAAC,cAAc,CAAC,CAAC,GAAC,EAAE,CAAC;YACzB,IAAI,GAAC,IAAI,GAAC,IAAI,CAAC,KAAK,CAAA,CAAC,CAAA,IAAI,CAAC,KAAK,CAAA,CAAC,CAAA,IAAI,CAAC;YACrC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAC,IAAI,EAAC,GAAG,CAAC,CAAC;SAClD;IACL,CAAC;IACD,qCAAa,GAAb,UAAc,cAAc;QACxB,IAAG,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAE,IAAI,CAAC,OAAO,EAAC;YACpD,IAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAE,CAAC,IAAE,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,cAAc,CAAC,CAAC,CAAC;gBACjD,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAE,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,cAAc,CAAC,CAAC,CAAC,EAAC;gBAC5D,OAAO;aACV;YACD,IAAI,IAAI,GAAC,cAAc,CAAC,CAAC,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA,CAAC,CAAA,cAAc,CAAC,CAAC,GAAC,IAAI,CAAC,OAAO,CAAA,CAAC,CAAA,cAAc,CAAC,CAAC,GAAC,IAAI,CAAC,OAAO,CAAC;YAClG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAC,IAAI,EAAC,GAAG,CAAC,CAAC;SAClD;IACL,CAAC;IACD,iDAAyB,GAAzB,UAA0B,MAAc;QACpC,IAAI,SAAS,GAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QAC5B,IAAI,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,qBAAqB,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;QAC3E,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,UAAU,EAAC,SAAS,CAAC,CAAC;QAC5D,OAAO,SAAS,CAAC;IACrB,CAAC;IACD,wCAAgB,GAAhB,UAAiB,IAAW,EAAC,QAAgB,EAAC,SAAgB;QAC1D,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;aAClB,EAAE,CAAC,IAAI,EAAC,EAAC,QAAQ,EAAC,QAAQ,EAAC,EAAC,EAAC,MAAM,EAAC,SAAS,EAAC,CAAC;aAC/C,KAAK,EAAE,CAAC;QACT,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC;aACxB,EAAE,CAAC,IAAI,EAAC,EAAC,SAAS,EAAC,SAAS,EAAC,EAAC,EAAC,MAAM,EAAC,SAAS,EAAC,CAAC;aACjD,KAAK,EAAE,CAAC;IACb,CAAC;;IArDM,sBAAQ,GAAe,IAAI,CAAC;IARlB,aAAa;QADjC,OAAO;OACa,aAAa,CAmEjC;IAAD,oBAAC;CAnED,AAmEC,CAnE0C,EAAE,CAAC,SAAS,GAmEtD;kBAnEoB,aAAa","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport { caijiTools } from \"../caijiTools\";\nimport GameManager from \"./GameManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class cameraControl extends cc.Component {\n\n    cameraNode:cc.Node=null;\n    mainCamera:cc.Camera=null;\n    offsetX:number=0;//相机移动条件:与玩家X轴相差临界值\n\n    y_min:number=-200;\n    y_max:number=90;\n    static instance:cameraControl=null;\n    onLoad () {\n        cameraControl.instance=this;\n        this.cameraNode=this.node;\n        this.offsetX=0;//cc.winSize.width/2*0.4;\n        this.mainCamera=this.node.getComponent(cc.Camera);\n    }\n\n    start () {     \n\n    }\n\n    update (dt) {\n        if(GameManager.instance.playerController==null) return;\n        let worldPos_player=GameManager.instance.player.parent.convertToWorldSpaceAR(GameManager.instance.player.position);\n        let nodePos_player=this.node.parent.convertToNodeSpaceAR(worldPos_player);\n        this.changeCameraX(nodePos_player);\n    }\n    changeCameraY(screenPos:cc.Vec2,nodePos_player){\n        let newY=0;\n        if((screenPos.y-320)>70){\n            newY=nodePos_player.y-70;\n            newY=newY>this.y_max?this.y_max:newY;\n            this.node.y=cc.misc.lerp(this.node.y,newY,0.05);\n        }else if(screenPos.y<250){\n            newY=nodePos_player.y+70;\n            newY=newY<this.y_min?this.y_min:newY;\n            this.node.y=cc.misc.lerp(this.node.y,newY,0.1);\n        }\n    }\n    changeCameraX(nodePos_player){\n        if(Math.abs(nodePos_player.x-this.node.x)>=this.offsetX){\n            if((this.node.x<=0&&this.node.x>nodePos_player.x)||\n            (this.node.x>=this.maxOffsetX[0]&&this.node.x<nodePos_player.x)){\n                return;\n            }\n            let newX=nodePos_player.x>this.node.x?nodePos_player.x-this.offsetX:nodePos_player.x+this.offsetX;\n            this.node.x=cc.misc.lerp(this.node.x,newX,0.1);\n        }\n    }\n    getPlayerPosInBuildCamera(player:cc.Node):cc.Vec2{\n        let screenPos=new cc.Vec2();\n        let toWorldPos = player.parent.convertToWorldSpaceAR(player.getPosition()); \n        this.mainCamera.getWorldToScreenPoint(toWorldPos,screenPos); \n        return screenPos;\n    }\n    changeCameraView(time:number,position:cc.Vec3,zoomRatio:number){\n        cc.tween(this.node)\n        .to(time,{position:position},{easing:\"sineOut\"})\n        .start();\n        cc.tween(this.mainCamera)\n        .to(time,{zoomRatio:zoomRatio},{easing:\"sineOut\"})\n        .start();\n    }\n\n    maxOffsetX:number[]=[\n        1300,50,1000,0,320,250,250,800,450,0,\n        1000,1100,650,1000,1000,1000,0,1100,1800,1100\n    ];\n}\n"]}