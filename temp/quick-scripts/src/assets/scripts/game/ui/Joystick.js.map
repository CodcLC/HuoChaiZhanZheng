{"version":3,"sources":["assets\\scripts\\game\\ui\\Joystick.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameManager from \"../GameManager\";\nimport playerController from \"../playerController\";\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class JoyStick extends cc.Component {\n\n    @property({\n        type: cc.Node,\n        displayName: '移动中心节点'\n    })\n    midNode: cc.Node = null;\n\n    @property({\n        type: cc.Node,\n        displayName: '摇杆背景节点'\n    })\n    joyBk: cc.Node = null;\n\n    @property({\n        displayName: '摇杆活动半径'\n    })\n    maxR: number = 100;\n    zoom: number = 0.3;\n/* \n    @property({\n        type: cc.Component.EventHandler,\n        displayName: '摇杆移动回调',\n        tooltip: '触发touchmove后分发数据'\n    }) */\n    joyCallBack: cc.Component.EventHandler = new cc.Component.EventHandler;\n\n    isKeyTouch_a:boolean=false;\n    isKeyTouch_d:boolean=false;\n    static instance:JoyStick=null;\n    onLoad() {\n        JoyStick.instance=this;\n        this.goBackMid();\n\n    }\n    init(){\n        this.joyCallBack.target = GameManager.instance.player;\n        this.joyCallBack.component=\"playerController\"\n        this.joyCallBack.handler = \"move\";\n        this.binEvent();\n    }\n    binEvent() {\n        this.joyBk.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.joyBk.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.joyBk.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.joyBk.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.keyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.keyUp, this);\n    }\n    removeEvent() {\n        this.joyBk.off(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.joyBk.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.joyBk.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.joyBk.off(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.keyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.keyUp, this);\n    }\n\n    goBackMid() {\n        this.midNode.setPosition(0, 0);\n    }\n\n    onTouchStart(event: cc.Event.EventTouch) {\n        let pos: cc.Vec2 = this.node.convertToNodeSpaceAR(cc.v2(event.getLocation()));\n        pos = cc.v2(pos.x * this.zoom, 0);\n        this.clampPos(pos);\n        this.midNode.setPosition(pos);\n        this.joyCallBack.emit([pos]);\n    }\n\n    onTouchMove(event: cc.Event.EventTouch) {\n        let pos: cc.Vec2 = this.node.convertToNodeSpaceAR(cc.v2(event.getLocation()));\n        pos = cc.v2(pos.x * this.zoom, 0);\n        this.clampPos(pos);\n        this.midNode.setPosition(pos);\n        this.joyCallBack.emit([pos]);\n    }\n\n    onTouchEnd(e: cc.Event.EventTouch) {\n        this.goBackMid();\n        this.joyCallBack.emit([cc.v2(0, 0)]);\n    }\n    keyDown(event: cc.Event.EventKeyboard) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n                this.isKeyTouch_a=true;\n                this.midNode.setPosition(-40,0);\n                this.joyCallBack.emit([cc.v2(-1,0)]);\n                break;\n            case cc.macro.KEY.d:\n                this.isKeyTouch_d=true;\n                this.midNode.setPosition(40,0);\n                this.joyCallBack.emit([cc.v2(1,0)]);\n                break;\n        }\n    }\n    keyUp(event: cc.Event.EventKeyboard) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n                if(this.isKeyTouch_d){\n                    this.isKeyTouch_a=false;\n                    this.isKeyTouch_d=true;\n                    this.midNode.setPosition(40,0);\n                    this.joyCallBack.emit([cc.v2(1,0)]);\n                    return;\n                } \n                this.isKeyTouch_a=false;\n                this.goBackMid();\n                this.joyCallBack.emit([cc.v2(0,0)]);\n                break;\n            case cc.macro.KEY.d:\n                if(this.isKeyTouch_a){\n                    this.isKeyTouch_d=false;\n                    this.isKeyTouch_a=true;\n                    this.midNode.setPosition(-40,0);\n                    this.joyCallBack.emit([cc.v2(-1,0)]);\n                    return;\n                } \n                this.isKeyTouch_d=false;\n                this.goBackMid();\n                this.joyCallBack.emit([cc.v2(0,0)]);\n                break;\n        }\n    }\n    /**\n     * 根据半径限制位置\n     * @param pos \n     */\n    clampPos(pos: cc.Vec2) {\n        let len: number = pos.mag();\n        if (len > this.maxR) {\n            let k: number = this.maxR / len;\n            pos.x *= k;\n            pos.y *= k;\n        }\n    }\n\n    /**\n     * 根据位置转化角度\n     * @param pos \n     */\n    couvertToAngle(pos: cc.Vec2) {\n        let r: number = Math.atan2(pos.y, pos.x);\n        let d: number = cc.misc.radiansToDegrees(r);\n        return d;\n    }\n\n    // update (dt) {}\n}\n"]}