{"version":3,"sources":["assets\\syyx_sdk\\controller\\ad\\ad_block.ts"],"names":[],"mappings":";;;;;;AAAA,gDAA+C;AAC/C,iEAA2D;AAC3D,6DAA4D;AAC5D,uDAAsD;AAEtD;IAAA;QACI;;UAEE;QACM,0BAAqB,GAAG,EAAE,CAAC;QAYnC;;WAEG;QACK,mBAAc,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;QAEjC;;WAEG;QACK,iBAAY,GAAG,KAAK,CAAA;QAE5B;;WAEG;QACK,cAAS,GAAG,IAAI,CAAA;IAmI5B,CAAC;IAjIG;;OAEG;IACK,4BAAS,GAAjB;QACI,IAAI,KAAK,GAAG,4BAAU,CAAC,gBAAgB,KAAK,GAAG,CAAC,cAAc,CAAC,EAAE;eAC1D,4BAAU,CAAC,gBAAgB,KAAK,GAAG,CAAC,cAAc,CAAC,GAAG,CAAA;QAC7D,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,KAAK,EAAE;YAC7B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAA;YACxB,IAAI,CAAC,UAAU,EAAE,CAAA;SACpB;IACL,CAAC;IAGO,6BAAU,GAAlB;QACI,IAAI,IAAI,GAAG,IAAI,CAAA;QACf,IAAI,CAAC,qBAAqB,GAAG,2BAAY,CAAC,mBAAmB,EAAE,CAAA;QAC/D,IAAI,IAAI,CAAC,qBAAqB,IAAI,IAAI,CAAC,qBAAqB,CAAC,kBAAkB,CAAC,EAAE;YAC9E,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,kBAAkB,CAAC,CAAC,KAAK,CAAA;SAC7E;QACD,IAAI,CAAC,UAAU,EAAE,CAAA;QACjB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAA;QACrB,IAAI,CAAC,UAAU,EAAE,CAAA;QAEjB,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,EAAE;YAC5E,IAAI,EAAE,GAAG,+BAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;YAC9D,OAAO,CAAC,GAAG,CAAC,oEAAoE,EAAE,EAAE,CAAC,CAAA;YACrF,IAAI,CAAC,QAAQ,IAAI,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;YAC5C,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC;gBACvB,IAAI,CAAC,UAAU,EAAE,CAAA;YACrB,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,CAAA;SAChB;IACL,CAAC;IAEO,6BAAU,GAAlB,UAAmB,KAAK,EAAE,OAAuB,EAAE,SAAkB,EAAE,MAAiB,EACpF,MAAiB,EAAE,OAAkB,EAAE,OAAkB;QACzD,IAAI,CAAC,UAAU,GAAG,SAAS,CAAA;QAC3B,IAAI,CAAC,SAAS,GAAG;YACb,KAAK,EAAE,KAAK;YACZ,OAAO,EAAE,OAAO;YAChB,SAAS,EAAE,SAAS;YACpB,MAAM,EAAE,MAAM;YACd,MAAM,EAAE,MAAM;YACd,OAAO,EAAE,OAAO;YAChB,OAAO,EAAE,OAAO;SACnB,CAAA;QACD,IAAI,KAAK,GAAG,mCAAgB,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAA;QACzD,IAAI,CAAC,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK,IAAI,GAAG,EAAE;YACxC,OAAO,CAAC,GAAG,CAAC,kEAAkE,CAAC,CAAA;YAC/E,OAAM;SACT;QACD,IAAI,CAAC,SAAS,EAAE,CAAA;IACpB,CAAC;IAEO,6BAAU,GAAlB;QACI,IAAI,CAAC,SAAS,GAAG,KAAK,CAAA;QACtB,IAAI,CAAC,aAAa,EAAE,CAAA;QACpB,2BAAY,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;IAC9D,CAAC;IAEO,gCAAa,GAArB;QACI,IAAI,CAAC,YAAY,GAAG,KAAK,CAAA;QACzB,OAAO;QACP,IAAI,CAAC,QAAQ,IAAI,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAC5C,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAA;IAC7B,CAAC;IAED;;;MAGE;IACM,6BAAU,GAAlB,UAAmB,SAAU;QAEzB,IAAI,IAAI,GAAG,IAAI,CAAA;QAEf,iBAAiB;QACjB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,IAAI,CAAC,UAAU,EAAE,CAAA;YACjB,OAAM;SACT;QAED,IAAI,mBAAmB,GAAG,CAAC,CAAA;QAC3B,IAAI,IAAI,CAAC,qBAAqB,IAAI,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,CAAC,EAAE;YACjF,IAAI,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE;gBAChE,mBAAmB,GAAG,IAAI,CAAC,qBAAqB,CAAC,qBAAqB,CAAC,CAAA;aAC1E;SACJ;QAED,IAAI,iBAAiB,GAAG,SAAS,CAAA;QACjC,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,iBAAiB,IAAI,CAAC,MAAM,EAAE;YACnD,iBAAiB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,iBAAiB,CAAA;SAC7D;QAED,IAAI,cAAc,GAAG,SAAS,CAAA;QAC9B,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,cAAc,IAAI,CAAC,EAAE;YAC1C,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,cAAc,CAAA;SACvD;QAED,IAAI,QAAQ,GAAG;YACX,OAAO,EAAE,GAAG,CAAC,SAAS,CAAC,KAAK;YAC5B,KAAK,EAAE,mCAAgB,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC;YAC1D,SAAS,EAAE,IAAI,CAAC,UAAU;YAC1B,QAAQ,EAAE,IAAI,CAAC,UAAU;YACzB,QAAQ,EAAE,IAAI,CAAC,UAAU;YACzB,KAAK,EAAE;gBACH,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;gBACtE,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,IAAI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU;aACjF;YACD,iBAAiB,EAAE,iBAAiB;YACpC,cAAc,EAAE,cAAc;YAC9B,aAAa,EAAE,mBAAmB;YAClC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC;YACpC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,IAAI,WAAW;YAE5D,MAAM,EAAE;gBACJ,OAAO,CAAC,KAAK,CAAC,kDAAkD,CAAC,CAAA;gBACjE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;oBACjB,IAAI,CAAC,UAAU,EAAE,CAAA;oBACjB,OAAM;iBACT;YACL,CAAC;YAED,OAAO,EAAE,UAAU,KAAK,EAAE,GAAG;gBACzB,OAAO,CAAC,KAAK,CAAC,mDAAmD,EAAE,GAAG,CAAC,CAAA;gBACvE,IAAI,CAAC,SAAS,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAA;YAChE,CAAC;SACJ,CAAA;QAED,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAA;IAC7C,CAAC;IACL,eAAC;AAAD,CAhKA,AAgKC,IAAA","file":"","sourceRoot":"/","sourcesContent":["import { syyx_manager } from \"../syyx_manager\";\r\nimport { syyx_const } from \"../../configs/syyx_sdk_config\";\r\nimport { syyx_sdk_utils } from \"../../utils/syyx_sdk_utils\";\r\nimport { syyx_adv_manager } from \"./syyx_adv_manager\";\r\n\r\nexport default class ad_block {\r\n    /**\r\n    * 远端运营配置\r\n    */\r\n    private _business_config_data = {};\r\n\r\n    /**\r\n     * 配置表广告id\r\n     */\r\n    private _ad_pos_id\r\n\r\n    /**\r\n     * 创建广告时传入的参数\r\n     */\r\n    private _ad_param\r\n\r\n    /**\r\n     * banner自动刷新时间\r\n     */\r\n    private auto_update_cd = [20, 20]\r\n\r\n    /**\r\n     * 是否正在倒计时刷新\r\n     */\r\n    private is_run_timer = false\r\n\r\n    /**\r\n     * 当前是否需要积木\r\n     */\r\n    private need_show = true\r\n\r\n    /**\r\n     * 自动刷新定时器\r\n     */\r\n    private run_timer() {\r\n        let is_qq = syyx_const.syyx_sdk_channel === igc.e_channel_type.qq\r\n            || syyx_const.syyx_sdk_channel === igc.e_channel_type.web\r\n        if (!this.is_run_timer && is_qq) {\r\n            this.is_run_timer = true\r\n            this.timer_func()\r\n        }\r\n    }\r\n\r\n    private timer_id\r\n    private timer_func() {\r\n        let self = this\r\n        this._business_config_data = syyx_manager.get_business_config()\r\n        if (this._business_config_data && this._business_config_data[\"banner_cool_time\"]) {\r\n            this.auto_update_cd = this._business_config_data[\"banner_cool_time\"].value\r\n        }\r\n        this.hide_block()\r\n        this.need_show = true\r\n        this.load_block()\r\n\r\n        if (this._ad_param && this._ad_param.style && this._ad_param.style.auto_update) {\r\n            let cd = syyx_sdk_utils.get_random_number(this.auto_update_cd)\r\n            console.log(\"igc------syyx_ui_block next time to refresh right side block's  cd\", cd)\r\n            this.timer_id && clearTimeout(this.timer_id)\r\n            this.timer_id = setTimeout(() => {\r\n                self.timer_func()\r\n            }, cd * 1000)\r\n        }\r\n    }\r\n\r\n    private show_block(style, ad_type?: igc.e_ad_type, ad_pos_id?: string, onLoad?: Function,\r\n        onShow?: Function, onClose?: Function, onError?: Function) {\r\n        this._ad_pos_id = ad_pos_id\r\n        this._ad_param = {\r\n            style: style,\r\n            ad_type: ad_type,\r\n            ad_pos_id: ad_pos_id,\r\n            onLoad: onLoad,\r\n            onShow: onShow,\r\n            onClose: onClose,\r\n            onError: onError,\r\n        }\r\n        let ad_id = syyx_adv_manager.get_channel_ad_id(ad_pos_id)\r\n        if (!ad_id || ad_id == \"1\" || ad_id == \"0\") {\r\n            console.log(\"igc----- ad_block native_interstitial_id no configure in adv.csv\")\r\n            return\r\n        }\r\n        this.run_timer()\r\n    }\r\n\r\n    private hide_block() {\r\n        this.need_show = false\r\n        this.destroy_timer()\r\n        syyx_manager.hide_ad(igc.e_ad_type.block, this._ad_pos_id)\r\n    }\r\n\r\n    private destroy_timer() {\r\n        this.is_run_timer = false\r\n        //销毁定时器\r\n        this.timer_id && clearTimeout(this.timer_id)\r\n        this.timer_id = undefined\r\n    }\r\n\r\n    /**\r\n    * 加载原生插屏\r\n    * @param call_back 加载数据成功回调\r\n    */\r\n    private load_block(call_back?) {\r\n\r\n        let self = this\r\n\r\n        //当前不需要展示任何banner\r\n        if (!this.need_show) {\r\n            this.hide_block()\r\n            return\r\n        }\r\n\r\n        let block_bottom_offset = 5\r\n        if (this._business_config_data && this._business_config_data[\"block_bottom_offset\"]) {\r\n            if (this._business_config_data[\"block_bottom_offset\"].value[0] > 0) {\r\n                block_bottom_offset = this._business_config_data[\"block_bottom_offset\"]\r\n            }\r\n        }\r\n\r\n        let vertical_center_y = undefined\r\n        if (this._ad_param.style.vertical_center_y >= -888888) {\r\n            vertical_center_y = this._ad_param.style.vertical_center_y\r\n        }\r\n\r\n        let vertical_right = undefined\r\n        if (this._ad_param.style.vertical_right >= 0) {\r\n            vertical_right = this._ad_param.style.vertical_right\r\n        }\r\n\r\n        let ad_param = {\r\n            ad_type: igc.e_ad_type.block,\r\n            ad_id: syyx_adv_manager.get_channel_ad_id(this._ad_pos_id),\r\n            ad_pos_id: this._ad_pos_id,\r\n            ad_event: this._ad_pos_id,  //只是填充\r\n            ad_scene: this._ad_pos_id,\r\n            style: {\r\n                left: this._ad_param.style.left >= 20 ? this._ad_param.style.left : 20, //left太小会报错\r\n                top: this._ad_param.style.top >= 50 ? this._ad_param.style.top : 50 //top太小会报错\r\n            },\r\n            vertical_center_y: vertical_center_y,\r\n            vertical_right: vertical_right,\r\n            bottom_offset: block_bottom_offset,//横向展示 且 距离底部的距离\r\n            size: this._ad_param.style.size || 5,\r\n            orientation: this._ad_param.style.orientation || \"landscape\", //vertical\r\n\r\n            onShow: function () {\r\n                console.error(\"igc-----syyx_adv_manager-------load_block onShow\")\r\n                if (!self.need_show) {\r\n                    self.hide_block()\r\n                    return\r\n                }\r\n            },\r\n\r\n            onError: function (param, err) {\r\n                console.error(\"igc-----syyx_adv_manager-------load_block onError\", err)\r\n                self._ad_param.onError && self._ad_param.onError(param, err)\r\n            }\r\n        }\r\n\r\n        igc.igc_main.instance.create_ad(ad_param)\r\n    }\r\n}\r\n\r\n\r\n"]}